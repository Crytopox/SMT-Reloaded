<Window x:Class="HISA.SovUpgradeFilterWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Infrastructure Upgrade Filters"
        Height="760"
        Width="700"
        MinHeight="560"
        MinWidth="560"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource UiBackgroundBrush}"
        Style="{StaticResource ModernWindowStyle}">

    <Window.Resources>
        <Style TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource UiTextPrimaryBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource UiStrokeSoftBrush}" />
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="Padding" Value="8" />
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource CardBorderStyle}" Padding="12" Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="Infrastructure Upgrade Filters" Style="{StaticResource SectionHeaderTextStyle}" />
                <TextBlock Text="Select which upgrade icons to display on the map."
                           Margin="0,6,0,0"
                           Foreground="{DynamicResource UiTextMutedBrush}" />
                <TextBlock Text="Selecting all keeps all upgrades visible."
                           Foreground="{DynamicResource UiTextMutedBrush}" />
            </StackPanel>
        </Border>

        <Border Grid.Row="1" Style="{StaticResource CardBorderStyle}" Padding="10" Margin="0,0,0,10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="UpgradeList" ItemsSource="{Binding UpgradeCategories}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <GroupBox Header="{Binding Name}">
                                <StackPanel>
                                    <ItemsControl ItemsSource="{Binding Items}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <UniformGrid Columns="2" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsChecked}" Margin="4,2" Style="{StaticResource ModernCheckBoxStyle}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <Image Source="{Binding Icon}" Width="18" Height="18" Margin="0,0,6,0" />
                                                        <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center" Foreground="{DynamicResource UiTextPrimaryBrush}" />
                                                    </StackPanel>
                                                </CheckBox>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <ItemsControl ItemsSource="{Binding SubGroups}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <GroupBox Header="{Binding Name}" Margin="0,6,0,0">
                                                    <ItemsControl ItemsSource="{Binding Items}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <UniformGrid Columns="2" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsChecked}" Margin="4,2" Style="{StaticResource ModernCheckBoxStyle}">
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <Image Source="{Binding Icon}" Width="18" Height="18" Margin="0,0,6,0" />
                                                                        <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center" Foreground="{DynamicResource UiTextPrimaryBrush}" />
                                                                    </StackPanel>
                                                                </CheckBox>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </GroupBox>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </GroupBox>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="All" Width="70" Margin="0,0,8,0" Click="SelectAll_Click" Style="{StaticResource GhostButtonStyle}" />
            <Button Content="Clear" Width="70" Margin="0,0,8,0" Click="ClearAll_Click" Style="{StaticResource GhostButtonStyle}" />
            <Button Content="Apply" Width="80" Margin="0,0,8,0" Click="Apply_Click" Style="{StaticResource GoldButtonStyle}" />
            <Button Content="Cancel" Width="80" IsCancel="True" Style="{StaticResource GhostButtonStyle}" />
        </StackPanel>
    </Grid>
</Window>
